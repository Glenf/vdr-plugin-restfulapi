<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <script src="jquery-1.6.2.js"></script>
    <script>

//change restfulapiHost according to your needs
var restfulapiHost = "http://127.0.0.1:8002/";

var oldOsdData = null;

function getHost(){
	return restfulapiHost;
}

function refreshOsdData()
{
  $.getJSON( getHost() + "osd.json", function(data){updateScreen(data)});
}

function updateScreen(data){
  var TextOsd = data.TextOsd;
  if (typeof TextOsd.title == "string")
  {
      $("div#header").html(TextOsd.title);
      $("div#header").toggleClass("invisible", false);
  }
  else
  {
      $("div#header").html("");
      $("div#header").toggleClass("invisible", true);
  }
  
  var colorButtons = [ "red", "green", "yellow", "blue" ];
  var showColorButtons = false;
  var z= 0;
  for (z = 0; z < colorButtons.length; z++)
  {
      var currentButton = "div#" + colorButtons[z];
      if (typeof (TextOsd[ colorButtons[z] ]) == "string" && TextOsd[ colorButtons[z] ] != "")
      {
          $( currentButton ).html(TextOsd[ colorButtons[z] ]);
          $( currentButton ).toggleClass("active", true);
          $( currentButton ).toggleClass("inactive", false);
          showColorButtons = true;
      }
      else
      {
          $( currentButton ).html("&nbsp;");
          $( currentButton ).toggleClass("active", false);
          $( currentButton ).toggleClass("inactive", true);
      }
  }
  $("div#color_buttons" ).toggleClass("invisible", !showColorButtons);
  $( "ul" ).empty();
  if (TextOsd.items.length > 0)
  {
      for (z = 0; z < TextOsd.items.length; z++)
      {
          var id = TextOsd.items[z].is_selected ? " id=\"selectedItem\"" : ""; 
          $( "ul" ).append("<li"+id+" class=\"item\">"+ TextOsd.items[z].content +"</li>")
      }
      $("div#content" ).toggleClass("invisible", false);
  }
  else
  {
      $("div#content" ).toggleClass("invisible", true);
  }
  oldOsdData = TextOsd;
  refreshOsdData();
}

 $(document).ready(function(){
    $("div.log").ajaxError(function(event, xhr, settings, exception) {
      $(this).text( "Triggered ajaxError handler." +
            xhr.responseText + "/" + xhr.status + "/" + settings.url );
    });
    refreshOsdData();
});

    </script>
    <link rel="stylesheet" type="text/css" href="osd.css" />
    <title>HTML based VDR OSD (passive slave)</title>
  </head>
  <body>
  <div id="osd_container">
    <div class="invisible" id="header">&nbsp;</div>
    <div class="invisible" id="content">
    <ul type="none">
    </ul>
    </div><!-- closing content container -->
    <div class="invisible2" id="color_buttons">
      <div id="red" class="first inactive">&nbsp;</div>
      <div id="green" class="second inactive">&nbsp;</div>
      <div id="yellow" class="third inactive">&nbsp;</div>
      <div id="blue" class="fourth inactive">&nbsp;</div>
      <br class="clear">
    </div><!-- closing color_buttons container -->
  </div><!-- closing osd_container -->
  </body>
</html>